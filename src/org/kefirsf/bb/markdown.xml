<?xml version="1.0" encoding="utf-8"?>
<configuration xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xmlns="http://kefirsf.org/kefirbb/schema"
               xsi:schemaLocation="http://kefirsf.org/kefirbb/schema http://kefirsf.org/kefirbb/schema/kefirbb-1.2.xsd">
    <scope name="ROOT" ignoreText="true">
        <code name="paragraph">
            <pattern><bol/><var scope="paragraphScope"/><blankline/></pattern>
            <template>&lt;p&gt;<var/>&lt;/p&gt;</template>
        </code>
        <code name="h1" priority="1">
            <pattern><bol/><var scope="escapeHtml"/><eol/>=<var name="junk" regex="=*"/><eol/></pattern>
            <template>&lt;h1&gt;<var/>&lt;/h1&gt;</template>
        </code>
        <code name="h2" priority="1">
            <pattern><bol/><var scope="escapeHtml"/><eol/>-<var name="junk" regex="\-*"/><eol/></pattern>
            <template>&lt;h2&gt;<var/>&lt;/h2&gt;</template>
        </code>
        <code name="hn" priority="1">
            <pattern><var name="count" regex="#{1,6}"/> <var scope="escapeHtml"/><var name="junk" regex="\s#+"/><eol/></pattern>
            <pattern><var name="count" regex="#{1,6}"/> <var scope="escapeHtml"/><eol/></pattern>
            <template>&lt;h<var name="count" function="length"/>&gt;<var/>&lt;/h<var name="count" function="length"/>&gt;</template>
        </code>
        <code name="hr" priority="1">
            <pattern><bol/><var regex="\*(\s\*){2,}"/><eol/></pattern>
            <pattern><bol/><var regex="\*{3,}"/><eol/></pattern>
            <pattern><bol/><var regex="\-(\s\-){2,}"/><eol/></pattern>
            <pattern><bol/><var regex="\-{3,}"/><eol/></pattern>
            <template>&lt;hr/&gt;</template>
        </code>
    </scope>

    <scope name="paragraphScope" parent="escapeMarkdown">
        <code name="br">
            <pattern>  <eol/></pattern>
            <template>&lt;br/&gt;</template>
        </code>
    </scope>

    <!-- Escape Markdown slashes -->
    <scope name="escapeMarkdown">
        <code>
            <pattern>\\</pattern>
            <template>\</template>
        </code>
        <code>
            <pattern>\`</pattern>
            <template>`</template>
        </code>
        <code>
            <pattern>\*</pattern>
            <template>*</template>
        </code>
        <code>
            <pattern>\_</pattern>
            <template>_</template>
        </code>
        <code>
            <pattern>\{</pattern>
            <template>{</template>
        </code>
        <code>
            <pattern>\}</pattern>
            <template>}</template>
        </code>
        <code>
            <pattern>\[</pattern>
            <template>[</template>
        </code>
        <code>
            <pattern>\]</pattern>
            <template>]</template>
        </code>
        <code>
            <pattern>\(</pattern>
            <template>(</template>
        </code>
        <code>
            <pattern>\)</pattern>
            <template>)</template>
        </code>
        <code>
            <pattern>\#</pattern>
            <template>#</template>
        </code>
        <code>
            <pattern>\+</pattern>
            <template>+</template>
        </code>
        <code>
            <pattern>\-</pattern>
            <template>-</template>
        </code>
        <code>
            <pattern>\.</pattern>
            <template>.</template>
        </code>
        <code>
            <pattern>\!</pattern>
            <template>!</template>
        </code>
    </scope>

    <!-- XML escape symbols -->
    <scope name="safeXml">
        <code priority="-2">
            <pattern>&apos;</pattern>
            <template>&amp;apos;</template>
        </code>
        <code priority="-2">
            <pattern>&lt;</pattern>
            <template>&amp;lt;</template>
        </code>
        <code priority="-2">
            <pattern>&gt;</pattern>
            <template>&amp;gt;</template>
        </code>
        <code priority="-2">
            <pattern>&quot;</pattern>
            <template>&amp;quot;</template>
        </code>
    </scope>

    <!-- Scope for escaping some symbols -->
    <scope name="escapeHtml" parent="safeXml">
        <!-- Ignore unknown tags -->
        <code priority="-1">
            <pattern>&lt;<junk/>&gt;</pattern>
            <template/>
        </code>

        <!-- Comment -->
        <code name="comment">
            <pattern>&lt;!--<junk/>&gt;</pattern>
            <template/>
        </code>
    </scope>
</configuration>